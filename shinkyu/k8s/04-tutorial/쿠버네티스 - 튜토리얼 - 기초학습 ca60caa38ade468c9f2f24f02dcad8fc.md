# 쿠버네티스 - 튜토리얼 - 기초학습

---

## Minikube로 쿠버네티스 설치

[https://kubernetes.io/ko/docs/setup/learning-environment/minikube/](https://kubernetes.io/ko/docs/setup/learning-environment/minikube/)

[https://phoenixnap.com/kb/install-minikube-on-centos](https://phoenixnap.com/kb/install-minikube-on-centos)

[https://www.oops4u.com/2366](https://www.oops4u.com/2366)    ⇒  AWS EC2에 minikube 설치 (t2.micro에는 구동할수 없음)

[https://docs.docker.com/engine/install/centos/](https://docs.docker.com/engine/install/centos/)   ⇒ Docker설치

**미니큐브 설치 완료 화면**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled.png)

**미니큐브 실행 화면**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%201.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%201.png)

---

### 클러스터 생성하기

[https://kubernetes.io/ko/docs/tutorials/kubernetes-basics/create-cluster/](https://kubernetes.io/ko/docs/tutorials/kubernetes-basics/create-cluster/)

1. 쿠버네티스 클러스터 두가지 형태의 자원으로 구성됩니다.

- **마스터** : 클러스터를 상호 조정한다.
- **노드** : 애플리케이션을 구동하는 작업자다

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%202.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%202.png)

**마스터는 클러스터 관리를 담당한다.**

마스터는 애플리케이션을 스케줄링하거나, 애플리케이션의 항상성을 유지 하거나, 애플리케이션을 스케일링하고, 새로운 변경 사항을 순서대로 반영하는 일과 같은 클러스터 내 모든 활동을 조율한다.

**노드는 쿠버네티스 클러스터 내 워커 머신으로써 동작하는 VM또는 물리적인 컴퓨터이다.**

각 노드는 노드를 관리하고 쿠버네티스 마스터와 통신하는 **Kubelet**이라는 에이전트를 갖는다.

노드는 컨테이너 운영을 담당하는 **containerd** 또는 **도커**와 같은 툴도 갖는다.

운영 트래픽을 처리하는 쿠버네티스 클러스터는 **최소 3대의 노드**를 가져야 한다.

**애플리케이션을 쿠버네티스에 배포한다는 것은, 마스터에 애플리케이션 컨테이너를 구동하라고 지시하는 것이다.**

마스터는 컨테이너를 클러스터의 어느 노드에 구동시킬지를 스케줄한다.

노드는 마스터가 제공하는 **쿠버네티스 API**를 통해서 마스터와 통신한다.

최종 사용자도 쿠버네티스 API를 직접 사용해서 클러스터와 상호작용 할수 있다.

실행명령문 정리하기

---

### 앱 배포하기

[https://kubernetes.io/ko/docs/tutorials/kubernetes-basics/deploy-app/deploy-intro/](https://kubernetes.io/ko/docs/tutorials/kubernetes-basics/deploy-app/deploy-intro/)

**Kuberctl을 사용해서 디플로이먼트 생성하기**

여기서는 아래와 같은 내용을 진행한다.

- 애플리케이션 디플로이 먼트에 대해 학습
- kubectl로 첫 애플리케이션을 쿠버네티스에 배포한다.

**쿠버네티스 디플로이먼트**

- 기능 : 애플리케이션 인스턴스를 생성해준다. 인스턴스 구동중 노드가 다운/삭제되면 다른 노드로 인스턴스 교체

일단 쿠버네티스를 구동시키면, 그 위에 컨테이너화된 애플리케이션을 배포할 수 있다.

**쿠버네티스 디플로이먼트 설정을 만들어야 한다.**

디플로이먼트는 쿠버네티스가 애플리케이션의 인스턴스를 어떻게 생성하고 업데이트 해야 하는지 지시한다.

디플로이먼트가 만들어지면, 쿠버네티스 마스터가 해당 디플로이먼트에 포함된 애플리케이션 인스턴스가 클러스터의 개별 노드에서 실행되도록 스케쥴 한다.

애플리케이션 인스턴스가 생성되면, 쿠버네티스 디플로이먼트 컨트롤러는 지속적으로 이들 인스턴스를 모니터링 한다.

인스턴스를 구동 중인 노드가 다운되거나 삭제되면, 디플로이먼트 컨트롤러가 인스턴스 클러스터 내부의 다른 노드의 인스턴스로 교체시켜 준다.

**디플로이 컨트롤러가 머신의 장애나 정비에 대응할 수 있는 자동복구(self-healing) 메커니즘을 제공한다.**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%203.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%203.png)

**Kubectl** 이라는 **쿠버네티스 CLI**를 통해 디플로이먼트를 생성하고 관리할 수 있다.

Kubectl은 클러스터와 상호 작용하기 위해 **쿠버네티스 API**를 사용한다.

디플로이먼트를 생성할 때, 애플리케이션에 대한 **컨테이너 이미지**와 구동시키고자 하는 **복제 수**를 지정해야 한다.

실행명령문 정리하기

---

### 앱 조사하기

이 단원에서는 파드, 노드에 대해서 정리합니다.

**1. 쿠버네티스 파드**

애플리케이션 배포를 진행하면 애플리케이션은 인스턴스에 파드를 생성합니다.

파드란? **하나 또는 그 이상의 애플리케이션 컨테이너(도커와 같은)들의 그룹**을 나타내는 쿠버네티스의 추상적 개념으로 일부는 컨테이너에 대한 자원을 공유합니다.

위에서 말한 자원은 다음을 포함합니다.

- 볼륨과 같은 공유 스토리지
- 클러스터 IP 주소와 같은 네트워크
- 컨테이너 이미지 버전 또는 사용할 특정 포트와 같이 각 컨테이너가 동작하는 방식에 대한 정보

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%204.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%204.png)

                                               **[파드 개념]**

**2. 노드**

**파드**는 **노드** 상에서 동작하다. 

**노드**는 쿠버네티스에서 **워커 머신**을 말하며, 클러스터에 따라 가상 또는 물리 머신일 수 있다. 각 워커 노드는 마스터에 의해 관리된다.

**하나의 노드 ⇒ 여러개의 파드 포함 가능**

쿠버네티스 마스터는 클러스터 내 노드를 통해서 파드에 대한 스케쥬링을 자동으로 처리한다.

**모든 쿠버네티스 노드는 다음과 같이 동작한다.**

- **Kubelet :** 쿠버네티스 마스터와 노드 간 통신을 책임지는 프로세스

      하나의 물리 머신 상에서 동작하는 파드 / 컨테이너 관리

- **컨테이너 런타임 :** 레지스트리에서 컨테이너 이미지를 가져와 묶여 있는 것을 풀고 애플리케이션을 동작시키는 역할

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%205.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%205.png)

                                               **[노드 개념]**

**3. kubectl로 문제해결 하기**

배포된 애플리케이션과 그 환경에 대한 정보 획득, 가장 보편적인 운영업무는 다음 kubectl 명령어를 이요하여 처리

- **kubectl get** : 자원 리스트를 조회
- **kubectl describe** : 자원에 대한 상세 조회
- **kubectl logs** : 파드 내 컨테이너의 로그 출력
- **kubectl exec** : 파드 내 컨테이너에 대한 명령 실행

**[실습내용]**

**kubectl get pods :** pod리스트 정보를 조회한다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%206.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%206.png)

kubectl describe pods : pod의 상세 정보 조회한다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%207.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%207.png)

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%208.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%208.png)

**Proxy 시작**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%209.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%209.png)

**환경변수에 저장된 Pod Name 조회**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2010.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2010.png)

**curl를 사용한 애플리케이션 출력하고 해당 URL은 Pod의 API에 대한 경로**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2011.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2011.png)

**애플리케이션이 일반적으로 STDOUT에 보내는 모든 것은 포드 내의 컨테이너에 대한 로그이다.**

**kubectl logs 명령어를 사용하여 로그를 검색할 수 있다.**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2012.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2012.png)

Pod가 가동되고 실행되면 컨테이너에서 직접 명령을 실행할 수 있습니다.

이를 위해 exec 명령을 사용하고 Pod의 이름을 매개 변수로 사용합니다

Pod 컨테이너에서의 bash 세션으로 시작하기

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2013.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2013.png)

기동시킬 소스 소스를 확인한다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2014.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2014.png)

curl 명령어를 실행하여 애플리케이션이 실행중인지 확인 가능하다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2015.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2015.png)

---

### 앱 외부로 노출하기

- 쿠버네티스 서비스에 대해서 학습한다.
- 레이블 / 레이블 셀렉터 오브젝트와 서비스의 연관성을 학습한다.
- 서비스를 이용한 쿠버네티스 클러스터 외부로 애플리케이션 노출하기.

**1. 쿠버네티스 서비스들에 대한 개요**

쿠버네티스 파드는 생명주기를 갖으며, **파드는 언젠가는 종료된다.**

**워커 노드**가 죽으면 노드상에서 동작하는 **파드들도 종료**된다.

레플리카셋(ReplicaSet)은 애플리케이션이 지속적으로 동작할 수 있도록 새로운 파드들의 생성을 통해????

**2. 서비스와 레이블**

- Service관련 참고 사이트 : [https://bcho.tistory.com/1262](https://bcho.tistory.com/1262)

쿠버네티스 Service에 대해서 설명한다.

Pod의 경우에 지정되는 Ip가 랜덤하게 지정이 되고 리스타트 때마다 변하기 때문에 고정된 엔드포인트로 호출이 어렵다. 또한 여러 Pod에 같은 애플리케이션을 운용할 경우 이 Pod 간의 로드밸런싱을 지원해줘야 하는데 Service가 이러한 역할을 한다.

Service는 지정된 IP로 생성이 가능하며, 여러 Pod를 묶어서 로드 밸런싱이 가능하며, 고유한 DNS 이름을 가질수 있다.

**서비스는 다음과 같이 구성**이 가능하며, 라벨 셀렉터(label selector)를 이용하여 관리하고자 하는 Pod들을 정의 할 수 있다.

apiVersion: v1
kind: Service
metadata:
  name: hello-node-svc
spec:
  selector:
    app: hello-node
  ports:
    - port: 80
      protocol: TCP
      targetPort: 8080
  type: LoadBalancer

**멀티 포트 지원**

Service는 동시에 하나의 Port 뿐 아니라 여러개의 포트를 동시에 지원할 수 있다.

예를 들어 웹서버의 HTTP / HTTPS 포트가 대표적인 예이다. 아래와 같이 정의가 가능하다.

apiVersion: v1
kind: Service
metadata:
  name: hello-node-svc
spec:
  selector:
    app: hello-node
  ports:
    - name: http
      port: 80
      protocol: TCP
      targetPort: 8080
    - name: https
      port: 443
      protocol: TCP
      targetPort: 8082
  type: LoadBalancer

**로드밸런싱 알고리즘**

Service가 Pod들에 부하를 분산할때 디폴트 알고리즘은 Pod간에 랜덤으로 부하를 분산하도록 한다.

만약에 특정 클라이언트가 특정 Pod로 지속적으로 연결이 되게 하려면 Session Affinity를 사용하면 되는데, 서비스의 spec 부분에 sessionAffinity: ClientIP로 주면 된다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2016.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2016.png)

웹에서 HTTP Session을 사용하는 경우와 같이 각 서버에 각 클라이언트의 상태 정보가 저장되어 있는 경우에 유용하게 사용할수 있다.

**Service Type**

Service는 IP주소 할당 방식과 연동 서비스등에 따라 크게 4가지로 구별할수 있다.

- **Cluster IP**

디폴트 설정으로 서비스에 클러스터IP(내부IP)를 할당한다.

쿠버네티스 클러스터 내에서는 이 Service에 접근이 가능하다지만, 클러스터 외부에서는 외부IP를 할당 받지 못했기 때문에 접근 불가하다.

- **Load Balancer**

외부IP를 가지고 있는 로드밸런서를 할당한다. 외부IP를 가지고 있기 때문에 클러스터 외부에서 접근이 가능하다.

- **NodePort**

Cluster IP로만 접근이 가능한 것이 아니라 모든 노드의 IP와 포트를 통해서도 접근이 가능하게 된다. 예를 들어 아래와 같이 hello-node-svc 라는 서비스를 NodePort 타입으로 선언을 하고, nodePort를 30036으로 설정하면, 아래 설정에 따라 클러스터 IP의 80포트로도 접근이 가능하지만, 모든 노드의 30036 포트로도 서비스를 접근할 수 있다.

hello-node-svc-nodeport.yaml

apiVersion: v1
kind: Service
metadata:
  name: hello-node-svc
spec:
  selector:
    app: hello-node
  type: NodePort
  ports:
    - name: http
      port: 80
      protocol: TCP
      targetPort: 8080
      nodePort: 30036

위의 yaml은 아래와 같은 구조가 된다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2017.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2017.png)

- **External Name**

External Name은 외부 서비스를 쿠버네티스 내부에서 호출하고자 할때 사용할 수 있다.

쿠버네티스 클러스터 내의 Pod들은 클러스터IP를 가지고 있기 때문에 클러스터 IP대역 밖의 서비스를 호출하고자 하면 NAT설정이 필요하다.

특히 AWS같으 클라우드 환경을 사용할 경우 Database나 클라우드의 매니지드 서비스(RDS)등을 사용하고자 할 경웨 쿠버네티스 클러스터 밖이기 때문에 호출이 어려운 경우가 있는데 이를 해결할수 있는 방법이 **External Name**이다.

아래와 같이 Servce - spec를 ExternalName 타입으로 설정하고, externalName을 my.database.exaple.com으로 설정해 주면 이 my-service는 들어오는 모든 요청을 my.database.example.com으로 포워딩 해준다. (일종의 프록지와 같은 역할)

kind: Service
apiVersion: v1
metadata:
  name: my-service
  namespace: prod
spec:
  type: ExternalName
  externalName: my.database.example.com

다음과 같은 구조로 서비스가 배포된다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2018.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2018.png)

[https://kubernetes.io/ko/docs/tutorials/kubernetes-basics/expose/expose-intro/](https://kubernetes.io/ko/docs/tutorials/kubernetes-basics/expose/expose-intro/)

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2019.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2019.png)

                                       **[서비스와 레이블]**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2020.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2020.png)

---

### 앱 스케일링하기

kubectl을 사용해서 애플리케이션을 스케일 한다.

**1. 애플리케이션을 스케일 하기**

앞 챕터에서는 deployment는 애플리케이션을 구동하기 위해 단 하나의 파드만 생성했습니다.

트래픽이 증가하면, 사용자 요청에 맞추어 애플리케이션의 규모를 조정할 필요가 있습니다.

여기서는 deployment 복제 Count를 수정 변경하면 **스케일링**이 수행된다.

**스케일링 개요**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2021.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2021.png)

                                                       **[스테일링 이전]**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2022.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2022.png)

                                                       **[스케일링 이후]**

deployment를 Scail-Out하면 **신규 파드가 생성**되어 가용한 자원이 있는 **노드에 스케줄**된다.

Scailing기능은 새로 의도한 상태(desired state)까지 파드의 수를 늘린다.

쿠버네티스는 파드의 Autoscailing도 지원하고, 모든 파드가 모두 종료되는 0까지도 가능하다.

애플리케이션의 인스턴스가 1개 구동되면 트랙픽을 해당 인스턴스 모두에 분산시킬 방법이 필요해 진다.

**Service**는 노출된 deployment의 모든 파드에 네트워크 트래픽을 분산시켜줄 로드밸런서를 갖는다.

**Service**는 엔드포인트를 이용해서 구동중인 파드를 지속적으로 모니터링 함으로써 가용한 파드에만 트래픽이 전달되도록 해준다.

복수의 애플리케이션의 인스턴스가 구동 중이면, 다운타임 없이 롤링 업데이트를 할수 있다.

**[실습 : Step1. Scaling a deployment]**

**kubectl get deployments명령얼 사용한 deployment 리스트 조회**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2023.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2023.png)

**kubectl get rs명령을 사용한 ReplicaSet 리스트 조회**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2024.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2024.png)

**kubectl scale명령을 사용한 배포를 복제본 4개로 확장**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2025.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2025.png)

**kubectl get deployments명령얼 사용한 deployment 리스트 조회 (1 → 4개로 늘어났음)**

해당 명령어가 적용되었으며 4 개의 응용 프로그램 인스턴스를 사용할 수 있습니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2026.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2026.png)

다음으로 Pod 수가 변경되었는지 확인하겠습니다.

서로다른 IP를 가진 파드가 나열됩니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2027.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2027.png)

변경 사항이 deployment 이벤트 로그에 등록되었습니다. 이를 확인하기 위해서 아래와 같은 명령어를 실해하였습니다.

kubectl describe deployments/kubernetes-bootcamp

이 명령의 출력에서 현재 4개의 복제본이 있음을 볼수 있습니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2028.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2028.png)

**[실습 : Step2. Load Balancing]**

서비스가 트래픽 부하를 분산하고 있는지 확인해 보겠습니다. 노출 된 IP 및 포트를 찾기 위해 이전 모듈에서 배운 설명 서비스를 사용할 수 있습니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2029.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2029.png)

노드 포트로 값이있는 NODE_PORT라는 환경 변수를 만듭니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2030.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2030.png)

**다음으로 노출 된 IP 및 포트에 대해 culr명령어를 수행합니다. 여러번 수행한다. 우리는 모든 요청에 대해 다른 포드에 도달했습니다. 이는 로드 밸런싱이 작동하고 있음을 보여줍니다.**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2031.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2031.png)

**[실습 : Step3. Scale Down]**

Service를 2개의 복제본으로 축소하려면 scale명령을 다시 실행합니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2032.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2032.png)

deployment 리스트를 조회하기 위해여 get deployments 명령으로 변경 사항이 적용되었다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2033.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2033.png)

복제본의 수가 3로 감소했습니다. get pods 명령을 사용하여 Pod 리스트를 조회한다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2034.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2034.png)

---

### 앱 업데이트하기

이번 장에서는 kubectl을 이용하여 롤링 업데이트 수행하겠다.

롤링 업데이트는 파드 인스턴스를 점진적으로 새로운 것으로 업데이트하여 업데이트가 서비스 중단 없이 이루어질수 있도록 해준다.

**1. 애플리케이션 업데이트 하기**

롤링 업데이트는 **파드**를 점진적으로 새로운 것으로 업데이트하여 디플로이먼트 업데이트가 서비스 중단 없이 이루어질 수 있도록 해준다. 새로운 파드는 가용한 자원을 보유한 노드로 스케줄될 것이다.

Service는 업데이트가 이루어지는 동안 오직 가용한 파드에게만 트래픽을 로드밸런스 할 것이다. 

**가용한 파드란?** 애플리케이션의 사용자들에게 가용한 상태의 인스턴스를 말한다.

롤링 업데이트는 다음 동작들을 허용해준다:

- 하나의 환경에서 또 다른 환경으로의 애플리케이션 프로모션

       (컨테이너 이미지 업데이트를 통해)

- 이전 버전으로의 롤백
- 서비스 중단 없는 애플리케이션의 지속적인 통합과 지속적인 전달

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2035.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2035.png)

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2036.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2036.png)

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2037.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2037.png)

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2038.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2038.png)

**[실습 : Step1. Update the version of the app]**

deployment리스트를 조회한다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2039.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2039.png)

실행중인 Pod를 나열하려면 get pods명령을 사용한다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2040.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2040.png)

앱의 현재 이미지 버전을 보려면 포드에 대해 describe 명령어를 실행합니다 (Image 필드 확인)

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2041.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2041.png)

애플리케이션의 이미지를 버전 2로 업데이트하려면 set image 명령을 사용한 다음 배포 이름과 새 이미지 버전을 사용합니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2042.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2042.png)

이 명령은 앱에 다른 이미지를 사용하도록 배포에 알리고 지속적 업데이트를 시작했습니다. 새 포드의 상태를 확인하고 get pods 명령으로 종료되는 이전 포드를 확인합니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2043.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2043.png)

**[실습 : Step2. Verify an update]**

먼저 앱이 실행 중인지 확인하겠습니다. 노출 된 IP 및 포트를 찾으려면 **describe services**를 사용할 수 있습니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2044.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2044.png)

Node port 값이 할당 된 NODE_PORT라는 환경 변수를 만듭니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2045.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2045.png)

다음으로 노출 된 IP 및 포트에 대해 curl 명령어를 수행합니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2046.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2046.png)

**rollout status명령어를 사용하여 업데이트를 확인할수 있다.**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2047.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2047.png)

앱의 현재 이미지 버전을 보려면 포드에 대해 describe 명령어를 실행합니다. 

(앱의 버전은 Image 필드값을 보면 v2가 있다.)

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2048.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2048.png)

**[실습 : Step3. Update the version of the app]**

v10 태그가 지정된 이미지를 배포하겠습니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2049.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2049.png)

get deployments 명령어를 사용하여 배포 상태를 확인합니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2050.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2050.png)

그리고 뭔가 잘못되었습니다. 원하는 수의 Pod를 사용할 수 없습니다. 

Pod를 다시 나열합니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2051.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2051.png)

Pod에 대한 describe 명령은 더 많은 정보를 제공해야합니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2052.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2052.png)

**저장소에 v10이라는 이미지가 없습니다. 이전에 작동했던 버전으로 롤백하겠습니다. rollout 실행 취소 명령을 사용합니다.**

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2053.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2053.png)

rollout 명령은 배포를 이전에 알려진 상태 (이미지의 v2)로 되돌 렸습니다. 업데이트의 버전이 지정되며 이전에 알고있는 배포 상태로 되돌릴 수 있습니다. Pod를 다시 나열합니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2054.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2054.png)

4 개의 포드가 실행 중입니다. 배포 된 이미지를 다시 확인하십시오.

배포에서 안정적인 버전의 앱 (v2)을 사용하고 있음을 확인했습니다. 롤백이 성공했습니다.

![%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2055.png](%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B5%E1%84%89%E1%85%B3%20-%20%E1%84%90%E1%85%B2%E1%84%90%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A5%E1%86%AF%20-%20%E1%84%80%E1%85%B5%E1%84%8E%E1%85%A9%E1%84%92%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3%E1%86%B8%20ca60caa38ade468c9f2f24f02dcad8fc/Untitled%2055.png)